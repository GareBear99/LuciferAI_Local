#!/usr/bin/env python3
"""
ğŸ©¸ Luc! - LuciferAI Package Manager CLI
Usage: luc! <command> [args]
"""
import sys
import os
from pathlib import Path

# Add project root to path
PROJECT_ROOT = Path(__file__).parent
sys.path.insert(0, str(PROJECT_ROOT))

# Colors
PURPLE = '\033[35m'
GREEN = '\033[32m'
RED = '\033[31m'
YELLOW = '\033[33m'
BLUE = '\033[34m'
CYAN = '\033[36m'
RESET = '\033[0m'


def show_banner():
    """Show Luc! banner."""
    print(f"""
{PURPLE}â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘  ğŸ©¸ Luc! - LuciferAI Package Manager      â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•{RESET}
""")


def show_help():
    """Show help message."""
    show_banner()
    print(f"""{YELLOW}Usage:{RESET}
  {BLUE}luc! install <package>{RESET}         Install package with smart fallback
  {BLUE}luc! create <env>{RESET}              Create new environment
  {BLUE}luc! list{RESET}                      List all environments
  {BLUE}luc! activate <env>{RESET}            Show activation script for environment
  {BLUE}luc! remove <env>{RESET}              Remove environment
  {BLUE}luc! info{RESET}                      Show current environment info
  {BLUE}luc! help{RESET}                      Show this help
  {BLUE}luc! version{RESET}                   Show version

{YELLOW}Examples:{RESET}
  luc! install requests              # Install package
  luc! install flask --manager pip   # Force specific manager
  luc! create myproject              # Create environment
  luc! list                          # List all environments
  
{YELLOW}Aliases:{RESET}
  {CYAN}luc!{RESET} = Full command
  {CYAN}luc{RESET}  = Also works (without exclamation)
""")


def main():
    """Main CLI entry point."""
    if len(sys.argv) < 2:
        show_help()
        sys.exit(0)
    
    command = sys.argv[1].lower()
    
    # Install command
    if command == "install":
        if len(sys.argv) < 3:
            print(f"{RED}âŒ Usage: luc! install <package>{RESET}")
            sys.exit(1)
        
        package = sys.argv[2]
        force_manager = None
        
        # Check for --manager flag
        if len(sys.argv) > 3 and sys.argv[3] == '--manager':
            if len(sys.argv) > 4:
                force_manager = sys.argv[4]
            else:
                print(f"{RED}âŒ --manager requires a value{RESET}")
                sys.exit(1)
        
        # Import and run installer
        from luci import install_package
        success = install_package(package, force_manager=force_manager)
        sys.exit(0 if success else 1)
    
    # Environment management commands
    elif command in ["create", "list", "ls", "activate", "remove", "rm", "info", "deactivate"]:
        from Luci_Environments.luci_env import main as env_main
        # Replace argv to pass to env manager
        sys.argv = ["luci_env.py"] + sys.argv[1:]
        env_main()
    
    # Help
    elif command in ["help", "--help", "-h"]:
        show_help()
    
    # Version
    elif command in ["version", "--version", "-v"]:
        print(f"{PURPLE}ğŸ©¸ Luc! v1.0.0{RESET}")
    
    # Unknown command
    else:
        print(f"{RED}âŒ Unknown command: {command}{RESET}")
        print(f"{YELLOW}Run 'luc! help' for usage{RESET}")
        sys.exit(1)


if __name__ == "__main__":
    try:
        main()
    except KeyboardInterrupt:
        print(f"\n{YELLOW}Interrupted{RESET}")
        sys.exit(130)
    except Exception as e:
        print(f"{RED}âŒ Error: {e}{RESET}")
        sys.exit(1)
